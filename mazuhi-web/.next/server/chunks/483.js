"use strict";exports.id=483,exports.ids=[483],exports.modules={59483:(e,o,t)=>{t.d(o,{F:()=>r});var s=t(21914),a=t(70292);let GoogleSheetsService=class GoogleSheetsService{async initializeAuth(){let e=process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL,o=process.env.GOOGLE_PRIVATE_KEY,t=process.env.GOOGLE_SHEET_ID;if(console.log("\uD83D\uDD0D Checking environment variables:"),console.log("- Email:",e?"‚úì Set":"‚ùå Missing"),console.log("- Private Key:",o?"‚úì Set":"‚ùå Missing"),console.log("- Sheet ID:",t?"‚úì Set":"‚ùå Missing"),!e||!o||!t)throw Error("Missing required Google Sheets environment variables");let r=o;r.startsWith('"')&&r.endsWith('"')&&(r=r.slice(1,-1)),console.log("\uD83D\uDD11 Private key format check:",{startsWithBegin:(r=r.replace(/\\n/g,"\n")).includes("-----BEGIN PRIVATE KEY-----"),endsWithEnd:r.includes("-----END PRIVATE KEY-----"),hasNewlines:r.includes("\n")});let i=new a.CR({email:e,key:r,scopes:["https://www.googleapis.com/auth/spreadsheets.readonly","https://www.googleapis.com/auth/drive.readonly"]}),n=new s.H4(t,i);return n}async testConnection(){try{let e=await this.initializeAuth();console.log("\uD83D\uDD17 Attempting to connect to Google Sheets..."),await e.loadInfo();let o={title:e.title,sheetCount:e.sheetCount,sheets:e.sheetsByIndex.map(e=>e.title)};return console.log("‚úÖ Connection successful! Sheet info:",o),{success:!0,message:"Connection successful!",sheetInfo:o}}catch(o){console.error("‚ùå Google Sheets connection error:",o);let e="Unknown error";return o instanceof Error&&(e=o.message),{success:!1,message:`Connection failed: ${e}`}}}async getMenuData(){try{console.log("\uD83D\uDD04 Fetching fresh data from Google Sheets...");let e=await this.initializeAuth();console.log("\uD83D\uDCCA Loading spreadsheet info..."),await e.loadInfo(),console.log("‚úÖ Document loaded:",e.title);let o=[];for(let t of[{id:"entradas",name:"Entradas",sheet:"Entradas"},{id:"arroces",name:"Arroces",sheet:"Arroces"},{id:"rollos-naturales",name:"Rollos Naturales",sheet:"Rollos_Naturales"},{id:"rollos-empanizados",name:"Rollos Empanizados",sheet:"Rollos_Empanizados"},{id:"rollos-especiales",name:"Rollos Especiales",sheet:"Rollos_Especiales"},{id:"rollos-horneados",name:"Rollos Horneados",sheet:"Rollos_Horneados"},{id:"bebidas",name:"Bebidas",sheet:"Bebidas"},{id:"postres",name:"Postres",sheet:"Postres"},{id:"extras",name:"Extras",sheet:"Extras"}]){let s=e.sheetsByTitle[t.sheet];if(s)try{console.log(`üìã Processing sheet: ${t.sheet}`),await s.loadHeaderRow();let e=await s.getRows(),a=e.map(e=>{let o=e.get("favorito"),t=o?.toLowerCase()==="true"||o?.toLowerCase()==="si"||!0===o,s=e.get("destacado"),a=s?.toLowerCase()==="true"||s?.toLowerCase()==="si"||!0===s,r=e.get("promomiercoles"),i=r?.toLowerCase()==="true"||r?.toLowerCase()==="si"||!0===r,n={nombre:e.get("nombre")||"",descripcion:e.get("descripcion")||"",precio:parseFloat(e.get("precio"))||0,imagen_url:e.get("imagen_url")||void 0,nuevo:e.get("nuevo")?.toLowerCase()==="true"||e.get("nuevo")?.toLowerCase()==="si",vegetariano:e.get("vegetariano")?.toLowerCase()==="true"||e.get("vegetariano")?.toLowerCase()==="si",picante:e.get("picante")?.toLowerCase()==="true"||e.get("picante")?.toLowerCase()==="si",favorito:t,destacado:a,promomiercoles:i};return n.nombre&&console.log(`üìå ${n.nombre}: favorito='${o}' -> ${t}, destacado='${s}' -> ${a}, promomiercoles='${r}' -> ${i}`),n}).filter(e=>""!==e.nombre.trim());console.log(`‚úÖ Found ${a.length} items in ${t.sheet}`),o.push({id:t.id,nombre:t.name,items:a})}catch(e){console.warn(`‚ö†Ô∏è Error reading sheet ${t.sheet}:`,e),o.push({id:t.id,nombre:t.name,items:[]})}else console.warn(`‚ö†Ô∏è Sheet ${t.sheet} not found`),o.push({id:t.id,nombre:t.name,items:[]})}return console.log(`üéâ Menu data loaded successfully! Total categories: ${o.length}`),console.log("ÔøΩ Returning fresh data without caching"),o}catch(e){throw console.error("‚ùå Error fetching menu data:",e),Error(`Failed to fetch menu data: ${e instanceof Error?e.message:"Unknown error"}`)}}async getCategoryData(e){try{let o=await this.initializeAuth();await o.loadInfo();let t=o.sheetsByTitle[e];if(!t)throw Error(`Sheet ${e} not found`);let s=await t.getRows();return s.map(e=>({nombre:e.get("nombre")||"",descripcion:e.get("descripcion")||"",precio:parseFloat(e.get("precio"))||0,imagen_url:e.get("imagen_url")||void 0,nuevo:e.get("nuevo")?.toLowerCase()==="true"||e.get("nuevo")?.toLowerCase()==="si",vegetariano:e.get("vegetariano")?.toLowerCase()==="true"||e.get("vegetariano")?.toLowerCase()==="si",picante:e.get("picante")?.toLowerCase()==="true"||e.get("picante")?.toLowerCase()==="si",favorito:e.get("favorito")?.toLowerCase()==="true"||e.get("favorito")?.toLowerCase()==="si"||!0===e.get("favorito")})).filter(e=>e.nombre&&""!==e.nombre.trim())}catch(e){throw console.error("‚ùå Error fetching category data:",e),Error("Failed to fetch category data")}}async getSucursales(){try{let e=await this.initializeAuth();await e.loadInfo(),console.log("\uD83D\uDCCA Available sheets:",e.sheetsByTitle);let o=e.sheetsByTitle.Sucursales;if(!o)return console.warn('‚ö†Ô∏è Sheet "Sucursales" not found. Available sheets:',Object.keys(e.sheetsByTitle)),[];await o.loadHeaderRow(),console.log("\uD83D\uDCCA Sucursales sheet columns:",o.headerValues);let t=await o.getRows();console.log(`üìã Processing ${t.length} rows from Sucursales sheet`);let s=t.map((e,o)=>{let t={id:`sucursal-${o+1}`,nombre:e.get("nombre")||"",direccion:e.get("direccion")||"",telefono:e.get("telefono")||"",horario:e.get("horario")||"",ciudad:e.get("ciudad")||"",estado:e.get("estado")||"",codigo_postal:e.get("codigo_postal")||"",imagen_url:e.get("imagen_url")||void 0,activa:e.get("activa")?.toLowerCase()==="true"||e.get("activa")?.toLowerCase()==="si"};return console.log(`üè™ Sucursal ${o+1}: ${t.nombre}, imagen: ${t.imagen_url?"‚úÖ Si":"‚ùå No"}, activa: ${t.activa}`),t}).filter(e=>""!==e.nombre.trim()&&e.activa);return console.log(`‚úÖ Total sucursales activas cargadas: ${s.length}`),s}catch(e){throw console.error("‚ùå Error fetching sucursales data:",e),Error(`Failed to fetch sucursales data: ${e instanceof Error?e.message:"Unknown error"}`)}}async getSucursalesByCity(e){let o=await this.getSucursales();return o.filter(o=>o.ciudad.toLowerCase().includes(e.toLowerCase()))}async getPromociones(){try{console.log("\uD83C\uDF81 Promociones API called"),console.log("\uD83D\uDD0D Checking environment variables:"),console.log(`- Email: ${process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL?"‚úì Set":"‚ùå Missing"}`),console.log(`- Private Key: ${process.env.GOOGLE_PRIVATE_KEY?"‚úì Set":"‚ùå Missing"}`),console.log(`- Sheet ID: ${process.env.GOOGLE_SHEET_ID?"‚úì Set":"‚ùå Missing"}`);let e=process.env.GOOGLE_PRIVATE_KEY?.replace(/\\n/g,"\n")||"";console.log("\uD83D\uDD11 Private key format check:",{startsWithBegin:e.startsWith("-----BEGIN"),endsWithEnd:e.endsWith("-----"),hasNewlines:e.includes("\n")});let o=await this.initializeAuth();await o.loadInfo(),console.log("\uD83D\uDCCA Available sheets:",Object.keys(o.sheetsByTitle));let t=o.sheetsByTitle.Promociones;if(!t)return console.warn('‚ö†Ô∏è Sheet "Promociones" not found. Available sheets:',Object.keys(o.sheetsByTitle)),[];await t.loadHeaderRow(),console.log("\uD83D\uDCCA Promociones sheet columns:",t.headerValues);let s=await t.getRows();console.log(`üìã Processing ${s.length} rows from Promociones sheet`);let a=s.map((e,o)=>{let t={id:`promocion-${o+1}`,nombre:e.get("nombre")||"",descripcion:e.get("descripcion")||"",imagen_url:e.get("imagen_url")||void 0,activa:e.get("activa")?.toLowerCase()==="true"||e.get("activa")?.toLowerCase()==="si",sucursal:e.get("sucursal")?.toLowerCase()==="true"||e.get("sucursal")?.toLowerCase()==="si",domicilio:e.get("domicilio")?.toLowerCase()==="true"||e.get("domicilio")?.toLowerCase()==="si"};return console.log(`üéÅ Promocion ${o+1}: ${t.nombre}, imagen: ${t.imagen_url?"‚úÖ Si":"‚ùå No"}, activa: ${t.activa}, sucursal: ${t.sucursal}, domicilio: ${t.domicilio}`),t}).filter(e=>""!==e.nombre.trim()&&e.activa);return console.log(`‚úÖ Total promociones activas cargadas: ${a.length}`),a}catch(e){throw console.error("‚ùå Error fetching promociones data:",e),Error(`Failed to fetch promociones data: ${e instanceof Error?e.message:"Unknown error"}`)}}async getPromocionesByType(e){let o=await this.getPromociones();return o.filter(o=>!0===o[e])}async getPlatillosDestacados(){console.log("‚≠ê Fetching platillos destacados");try{let e=await this.getMenuData(),o=[];return e.forEach(e=>{e.items.forEach(t=>{(t.destacado||t.favorito)&&o.push({...t,categoria:e.nombre})})}),console.log(`‚úÖ Found ${o.length} platillos destacados`),o}catch(e){throw console.error("‚ùå Error fetching platillos destacados:",e),Error(`Failed to fetch platillos destacados: ${e instanceof Error?e.message:"Unknown error"}`)}}};let r=new GoogleSheetsService}};