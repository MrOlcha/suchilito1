(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[716],{2270:function(e,t,a){Promise.resolve().then(a.bind(a,6773))},6773:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return RestaurantPage}});var s=a(7437),l=a(2265),n=a(6691),r=a.n(n),i=a(5251),o=a(2167),c=a(7227),d=a(5106),x=a(5255),m=a(5856),h=a(6689),g=a(9186);let u=[{id:"conChile",label:"Con Chile",default:!1},{id:"picosillo",label:"Picosillo",default:!1}];function RestaurantPage(){var e,t;let[a,n]=(0,l.useState)([]),[p,b]=(0,l.useState)([]),[f,y]=(0,l.useState)(!0),[j,N]=(0,l.useState)(!1),[v,w]=(0,l.useState)(!1),[C,k]=(0,l.useState)(""),[E,S]=(0,l.useState)("1"),[q,M]=(0,l.useState)(!1),[O,P]=(0,l.useState)(null),[_,D]=(0,l.useState)({conChile:!1,picosillo:!1,notar:""});(0,l.useEffect)(()=>{let fetchMenu=async()=>{try{console.log("\uD83D\uDCE5 Cargando men\xfa desde /api/menu");let e=await fetch("/api/menu"),t=await e.json(),a=t.data||t.categories||[];a.length>0&&(n(a),k(a[0].nombre||a[0].name),console.log("✅ Men\xfa cargado"))}catch(e){console.error("❌ Error loading menu:",e)}finally{y(!1)}};fetchMenu()},[]);let addToCart=e=>{P(e),D({conChile:!1,picosillo:!1,notar:""})},updateQuantity=(e,t)=>{b(a=>a.map(a=>{if(a.id===e){let e=a.quantity+t;return e>0?{...a,quantity:e}:a}return a}).filter(e=>e.quantity>0))},removeFromCart=e=>{b(t=>t.filter(t=>t.id!==e))},F=p.reduce((e,t)=>e+t.item.precio*t.quantity,0),Z=p.reduce((e,t)=>e+t.quantity,0),getOptionsDescription=e=>{let t=[];return e.conChile&&t.push("Con Chile"),e.picosillo&&t.push("Picosillo"),e.notar&&t.push("Nota: ".concat(e.notar)),t.length>0?t.join(" • "):"Sin opciones"},sendOrder=async()=>{if(0===p.length){alert("Agrega productos al carrito");return}N(!0);try{let e=await fetch("/api/waiter-notification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cart:{items:p.map(e=>({menuItem:e.item,quantity:e.quantity,subtotal:e.item.precio*e.quantity,options:{complementos:[],soya:null,cubiertos:null},specialOptions:e.options})),total:F,itemCount:Z},tableNumber:E,isParaLlevar:q,isWaiterOrder:!0})}),t=await e.json();t.success?(w(!0),b([]),S("1"),M(!1),setTimeout(()=>w(!1),3e3)):alert("Error al enviar: "+t.message)}catch(e){console.error("❌ Error al enviar pedido:",e),alert("Error de conexi\xf3n")}finally{N(!1)}};return f?(0,s.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full"})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col lg:flex-row",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,s.jsx)("header",{className:"bg-gray-800 shadow-lg z-30",children:(0,s.jsxs)("div",{className:"px-4 py-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(r(),{src:"/images/iconologo.svg",alt:"Logo",width:40,height:40}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"font-bold text-lg",children:"Mazuhi"}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Modo Mesero"})]})]}),(0,s.jsx)("div",{className:"flex overflow-x-auto pb-2 gap-2 scrollbar-hide",children:a.map(e=>{let t=e.nombre||e.name||"";return(0,s.jsx)("button",{onClick:()=>k(t),className:"px-3 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ".concat(C===t?"bg-orange-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:t.replace(/_/g," ")},t)})})]})}),(0,s.jsx)("main",{className:"flex-1 overflow-y-auto p-3 md:p-4",children:(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-3 gap-3",children:null===(t=a.find(e=>(e.nombre||e.name)===C))||void 0===t?void 0:null===(e=t.items)||void 0===e?void 0:e.map((e,t)=>{let a=p.filter(t=>t.item.nombre===e.nombre).length;return(0,s.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.03*t},onClick:()=>addToCart(e),className:"bg-gray-800 rounded-xl overflow-hidden cursor-pointer transition-all hover:scale-105 hover:shadow-xl ".concat(a>0?"ring-2 ring-orange-500":""),children:[(0,s.jsxs)("div",{className:"relative h-20 sm:h-24",children:[(0,s.jsx)(r(),{src:e.imagen_url||"/images/menu/placeholder.jpg",alt:e.nombre,fill:!0,className:"object-cover"}),a>0&&(0,s.jsx)("div",{className:"absolute top-1 right-1 bg-orange-500 text-white w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold",children:a})]}),(0,s.jsxs)("div",{className:"p-2",children:[(0,s.jsx)("h3",{className:"font-medium text-xs sm:text-sm truncate",children:e.nombre}),(0,s.jsxs)("p",{className:"text-orange-400 font-bold text-xs sm:text-sm",children:["$",e.precio]})]})]},e.nombre+t)})})})]}),(0,s.jsxs)("div",{className:"w-full lg:w-80 bg-gray-800 border-l border-gray-700 flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-700 space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Mesa"}),(0,s.jsx)("div",{className:"flex gap-2 flex-wrap",children:["1","2","3","4","5","6"].map(e=>(0,s.jsx)("button",{onClick:()=>S(e),className:"w-10 h-10 rounded-lg font-bold transition-all text-sm ".concat(E===e?"bg-orange-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:e},e))})]}),(0,s.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer p-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition-all",children:[(0,s.jsx)("input",{type:"checkbox",checked:q,onChange:e=>M(e.target.checked),className:"w-5 h-5 cursor-pointer"}),(0,s.jsx)("span",{className:"font-medium text-sm",children:"Para llevar"})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:0===p.length?(0,s.jsx)("div",{className:"flex items-center justify-center h-full text-gray-400 text-sm",children:(0,s.jsx)("p",{children:"Carrito vac\xedo"})}):p.map(e=>(0,s.jsxs)("div",{className:"bg-gray-700 rounded-lg p-2 text-xs",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,s.jsx)("p",{className:"font-medium truncate flex-1",children:e.item.nombre}),(0,s.jsx)("button",{onClick:()=>removeFromCart(e.id),className:"w-5 h-5 bg-red-600/20 text-red-400 rounded flex items-center justify-center hover:bg-red-600/40 flex-shrink-0",children:(0,s.jsx)(c.Z,{className:"w-3 h-3"})})]}),(e.options.conChile||e.options.picosillo||e.options.notar)&&(0,s.jsx)("p",{className:"text-gray-400 text-xs mb-1 truncate",children:getOptionsDescription(e.options)}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-orange-400 font-bold",children:["$",(e.item.precio*e.quantity).toFixed(2)]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("button",{onClick:()=>updateQuantity(e.id,-1),className:"w-5 h-5 bg-gray-600 rounded flex items-center justify-center hover:bg-gray-500 text-xs",children:(0,s.jsx)(d.Z,{className:"w-2 h-2"})}),(0,s.jsx)("span",{className:"w-4 text-center text-xs font-medium",children:e.quantity}),(0,s.jsx)("button",{onClick:()=>updateQuantity(e.id,1),className:"w-5 h-5 bg-gray-600 rounded flex items-center justify-center hover:bg-gray-500 text-xs",children:(0,s.jsx)(x.Z,{className:"w-2 h-2"})})]})]})]},e.id))}),(0,s.jsxs)("div",{className:"border-t border-gray-700 p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"bg-gray-700 rounded-lg p-3 text-sm space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{children:["Mesa: ",(0,s.jsx)("span",{className:"font-bold",children:E})]}),q&&(0,s.jsx)("span",{className:"text-orange-400 font-bold text-xs",children:"Para Llevar"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-gray-300",children:[(0,s.jsxs)("span",{children:[Z," producto",1!==Z?"s":""]}),(0,s.jsxs)("span",{className:"text-orange-400 font-bold",children:["$",F.toFixed(2)]})]})]}),(0,s.jsx)("button",{onClick:sendOrder,disabled:j||0===p.length,className:"w-full flex items-center justify-center gap-2 bg-orange-500 hover:bg-orange-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-3 rounded-xl transition-all text-sm",children:j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),"Enviando..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{className:"w-4 h-4"}),"Enviar"]})})]})]}),(0,s.jsx)(o.M,{children:O&&(0,s.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)(i.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-gray-800 rounded-2xl max-w-sm w-full p-6 max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:O.nombre}),(0,s.jsxs)("p",{className:"text-orange-400 font-bold text-lg",children:["$",O.precio]})]}),(0,s.jsx)("button",{onClick:()=>P(null),className:"text-gray-400 hover:text-white flex-shrink-0",children:(0,s.jsx)(h.Z,{className:"w-6 h-6"})})]}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-300",children:"Opciones Especiales"}),u.map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-3 p-3 bg-gray-700 rounded-lg hover:bg-gray-600 cursor-pointer transition-all",children:[(0,s.jsx)("input",{type:"checkbox",checked:_[e.id]||!1,onChange:t=>D(a=>({...a,[e.id]:t.target.checked})),className:"w-5 h-5 cursor-pointer"}),(0,s.jsx)("span",{className:"font-medium",children:e.label})]},e.id))]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Notas adicionales"}),(0,s.jsx)("textarea",{value:_.notar||"",onChange:e=>D(t=>({...t,notar:e.target.value})),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-orange-500 text-sm",placeholder:"Ej: Sin anguila, extra picante...",rows:3})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>P(null),className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-lg transition-all",children:"Cancelar"}),(0,s.jsx)("button",{onClick:()=>{if(!O)return;let e="".concat(O.nombre,"-").concat(Date.now(),"-").concat(Math.random());b(t=>[...t,{id:e,item:O,quantity:1,options:{..._}}]),P(null)},className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 rounded-lg transition-all",children:"Agregar"})]})]})})}),(0,s.jsx)(o.M,{children:v&&(0,s.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:(0,s.jsxs)(i.E.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},className:"bg-gray-800 rounded-2xl p-8 text-center max-w-sm mx-4",children:[(0,s.jsx)(g.Z,{className:"w-20 h-20 text-green-500 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"\xa1Pedido Enviado!"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:"La notificaci\xf3n ha sido enviada a cocina"})]})})})]})}}},function(e){e.O(0,[597,358,744],function(){return e(e.s=2270)}),_N_E=e.O()}]);